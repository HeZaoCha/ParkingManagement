{% extends 'base.html' %}
{% load static %}

{% block title %}重置密码 - 停车场管理系统{% endblock %}

{% block body_class %}min-h-screen flex items-center justify-center p-4 relative overflow-hidden{% endblock %}

{% block extra_css %}

{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'auth/reset_password/css/style.css' %}">
<div class="reset-password-bg"></div>

<div class="w-full max-w-md relative z-10">
  <div class="reset-password-card card-theme rounded-2xl overflow-hidden backdrop-blur-xl bg-opacity-90">
    <div class="bg-gradient-theme p-8 text-center relative overflow-hidden">
      <div class="absolute inset-0 bg-black/10"></div>
      <div class="relative z-10">
        <div class="w-20 h-20 mx-auto mb-4 bg-white/20 backdrop-blur rounded-2xl flex items-center justify-center shadow-lg">
          <i class="fas fa-lock text-white text-4xl"></i>
        </div>
        <h1 class="text-2xl font-bold text-white text-shadow">重置密码</h1>
        <p class="text-white/80 mt-2 text-sm">请输入验证码和新密码</p>
        {% if email %}
        <p class="text-white/70 mt-1 text-xs" id="email-display" aria-label="邮箱地址">{{ email|slice:":3" }}***{{ email|slice:"-10:" }}</p>
        {% endif %}
      </div>
    </div>

    <div class="p-8">
      <form id="reset-password-form" class="space-y-5" novalidate>
        {% csrf_token %}
        <input type="hidden" name="email" value="{{ email }}">
        
        <div>
          <label for="code" class="block text-sm font-medium text-theme-secondary mb-2">
            <i class="fas fa-shield-alt mr-2 text-primary-500" aria-hidden="true"></i>验证码
          </label>
          <div class="flex gap-2">
            <input type="text" 
                   id="code" 
                   name="code" 
                   required
                   maxlength="10"
                   class="input-theme flex-1 px-4 py-3 rounded-xl transition-all" 
                   placeholder="请输入验证码"
                   autocomplete="one-time-code"
                   inputmode="numeric"
                   pattern="[0-9]{6,10}"
                   aria-describedby="code-hint"
                   aria-required="true">
            <button type="button" 
                    onclick="resendCode()" 
                    id="resend-btn"
                    class="px-4 py-3 border border-theme text-theme-secondary rounded-xl hover:bg-theme-hover transition-all hover:scale-105 active:scale-95"
                    aria-label="重新发送验证码">
              <i class="fas fa-redo mr-1" aria-hidden="true"></i>重发
            </button>
          </div>
          <p id="code-hint" class="text-xs text-theme-muted mt-2">
            <i class="fas fa-info-circle mr-1" aria-hidden="true"></i>
            验证码已发送到您的邮箱，10分钟内有效
          </p>
        </div>

        <div>
          <label for="new_password" class="block text-sm font-medium text-theme-secondary mb-2">
            <i class="fas fa-key mr-2 text-primary-500"></i>新密码
          </label>
          <div class="relative">
            <span class="absolute inset-y-0 left-0 flex items-center pl-4 text-theme-muted">
              <i class="fas fa-lock" aria-hidden="true"></i>
            </span>
            <input type="password" 
                   id="new_password" 
                   name="new_password" 
                   required
                   minlength="8"
                   maxlength="128"
                   class="input-theme w-full pl-11 pr-12 py-3 rounded-xl transition-all" 
                   placeholder="至少8个字符，建议使用passphrase（多个单词组合）" 
                   autocomplete="new-password"
                   oninput="checkPasswordStrength(this.value)"
                   aria-describedby="password-strength-text password-hint"
                   aria-required="true">
            <button type="button" 
                    id="toggleNewPassword" 
                    class="absolute inset-y-0 right-0 flex items-center pr-4 text-theme-muted hover:text-primary-500 transition-colors"
                    aria-label="切换密码可见性"
                    aria-pressed="false">
              <i class="fas fa-eye-slash" aria-hidden="true"></i>
            </button>
          </div>
          {# 密码强度指示器 #}
          <div class="mt-2">
            <div class="password-strength bg-theme-secondary" 
                 id="password-strength-bar"
                 role="progressbar"
                 aria-valuenow="0"
                 aria-valuemin="0"
                 aria-valuemax="100"
                 aria-label="密码强度"></div>
            <p id="password-strength-text" class="text-xs text-theme-muted mt-1" aria-live="polite">密码强度：未设置（需要至少中级强度，50分以上）</p>
            <p id="password-hint" class="text-xs text-theme-muted mt-1">
              <i class="fas fa-lightbulb mr-1" aria-hidden="true"></i>
              密码长度8-128个字符，支持所有字符类型（包括空格和特殊字符）。建议使用passphrase（多个单词组合）以提高安全性和易记性
            </p>
          </div>
        </div>

        <div>
          <label for="confirm_password" class="block text-sm font-medium text-theme-secondary mb-2">
            <i class="fas fa-check-circle mr-2 text-primary-500" aria-hidden="true"></i>确认密码
          </label>
          <div class="relative">
            <span class="absolute inset-y-0 left-0 flex items-center pl-4 text-theme-muted" aria-hidden="true">
              <i class="fas fa-lock"></i>
            </span>
            <input type="password" 
                   id="confirm_password" 
                   name="confirm_password" 
                   required
                   minlength="8"
                   maxlength="128"
                   class="input-theme w-full pl-11 pr-12 py-3 rounded-xl transition-all" 
                   placeholder="请再次输入新密码" 
                   autocomplete="new-password"
                   oninput="checkPasswordMatch()"
                   aria-describedby="password-match-hint"
                   aria-required="true">
            <button type="button" 
                    id="toggleConfirmPassword" 
                    class="absolute inset-y-0 right-0 flex items-center pr-4 text-theme-muted hover:text-primary-500 transition-colors"
                    aria-label="切换密码可见性"
                    aria-pressed="false">
              <i class="fas fa-eye-slash" aria-hidden="true"></i>
            </button>
          </div>
          <p id="password-match-hint" class="text-xs mt-2 hidden" role="alert" aria-live="polite"></p>
        </div>

        {# 消息提示 #}
        <div id="message-container" 
             class="hidden"
             role="alert"
             aria-live="polite">
          <div id="message-content" class="p-4 rounded-xl"></div>
        </div>

        {# 按钮组 #}
        <div class="flex gap-3">
          <a href="{% url 'parking:forgot_password' %}" 
             class="flex-1 px-4 py-3 border border-theme text-theme-secondary rounded-xl hover:bg-theme-hover transition-all text-center hover:scale-105 active:scale-95"
             aria-label="返回忘记密码页面">
            <i class="fas fa-arrow-left mr-2" aria-hidden="true"></i>返回
          </a>
          <button type="submit" 
                  id="submit-btn"
                  class="flex-1 px-4 py-3 btn-primary rounded-xl font-medium flex items-center justify-center gap-2 hover:scale-105 active:scale-95 transition-all group"
                  aria-label="重置密码">
            <span>重置密码</span>
            <i class="fas fa-check group-hover:scale-110 transition-transform" aria-hidden="true"></i>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>


<script src="{% static 'auth/reset_password/js/script.js' %}"></script>
{% endblock %}
