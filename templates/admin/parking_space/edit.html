{% extends 'admin/base.html' %}
{% load static %}

{% block title %}{% if space %}编辑车位{% else %}新增车位{% endif %}{% endblock %}
{% block page_title %}{% if space %}编辑车位{% else %}新增车位{% endif %}{% endblock %}

{% block breadcrumb %}
<nav class="flex items-center gap-2 text-sm text-slate-400 ml-4" aria-label="面包屑导航">
    <a href="{% url 'parking:admin_index' %}" class="hover:text-white" aria-label="返回首页">首页</a>
    <i class="fas fa-chevron-right text-xs" aria-hidden="true"></i>
    <a href="{% url 'parking:admin_parking_space_list' %}" class="hover:text-white" aria-label="车位管理">车位管理</a>
    <i class="fas fa-chevron-right text-xs" aria-hidden="true"></i>
    <span class="text-slate-200" aria-current="page">{% if space %}编辑{% else %}新增{% endif %}</span>
</nav>
{% endblock %}

{% block content %}
<div class="max-w-2xl">
    <form method="post" 
          class="space-y-6" 
          novalidate 
          data-validate 
          data-parking-space-data="true"
          data-current-floor="{% if space %}{{ space.floor|default:'' }}{% endif %}"
          data-current-area="{% if space %}{{ space.area|default:'' }}{% endif %}"
          onsubmit="return validateParkingSpaceForm(event)">
        {% csrf_token %}
        
        <div class="bg-slate-800/50 border border-slate-700/50 rounded-xl p-6 space-y-5" role="region" aria-labelledby="space-info-title">
            <h3 id="space-info-title" class="text-lg font-semibold text-white border-b border-slate-700/50 pb-4 mb-5">
                <i class="fas fa-square-parking text-primary-400 mr-2" aria-hidden="true"></i>
                车位信息
            </h3>
            
            <!-- 停车场 -->
            <div>
                <label for="parking-lot-select" class="block text-sm font-medium text-slate-300 mb-2">
                    所属停车场 <span class="text-red-400" aria-label="必填">*</span>
                </label>
                <select id="parking-lot-select"
                        name="parking_lot" 
                        required
                        class="w-full px-4 py-3 bg-slate-900/50 border border-slate-700 rounded-lg text-white focus:outline-none focus:border-primary-500 focus:ring-1 focus:ring-primary-500"
                        aria-describedby="parking-lot-hint"
                        aria-required="true">
                    <option value="">请选择停车场</option>
                    {% for lot in lots %}
                    <option value="{{ lot.pk }}" 
                            {% if space.parking_lot_id == lot.pk or request.GET.lot == lot.pk|stringformat:"s" %}selected{% endif %}>
                        {{ lot.name }}
                    </option>
                    {% endfor %}
                </select>
                <p id="parking-lot-hint" class="mt-1 text-xs text-slate-500 sr-only">选择车位所属的停车场</p>
            </div>
            
            <!-- 车位号 -->
            <div>
                <label for="space-number-input" class="block text-sm font-medium text-slate-300 mb-2">
                    车位号 <span class="text-red-400" aria-label="必填">*</span>
                </label>
                <input type="text" 
                       id="space-number-input"
                       name="space_number" 
                       value="{{ space.space_number|default:'' }}" 
                       required
                       data-validation="required"
                       placeholder="如: A001, B012"
                       class="w-full px-4 py-3 bg-slate-900/50 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:border-primary-500 focus:ring-1 focus:ring-primary-500"
                       aria-describedby="space-number-hint space-number-input-error"
                       aria-required="true">
                <div id="space-number-input-error" class="text-xs text-red-500 mt-1 hidden" role="alert" aria-live="polite"></div>
                <p id="space-number-hint" class="mt-1 text-xs text-slate-500">请输入车位号，如：A001, B012</p>
            </div>
            
            <!-- 楼层（动态加载） -->
            <div id="floor-field" class="hidden" role="region" aria-labelledby="floor-title">
                <label id="floor-title" for="floor-select" class="block text-sm font-medium text-slate-300 mb-2">
                    所在楼层
                </label>
                <select name="floor" 
                        id="floor-select"
                        class="w-full px-4 py-3 bg-slate-900/50 border border-slate-700 rounded-lg text-white focus:outline-none focus:border-primary-500 focus:ring-1 focus:ring-primary-500"
                        aria-describedby="floor-hint">
                    <option value="">无（露天停车场）</option>
                </select>
                <p id="floor-hint" class="mt-1 text-xs text-slate-500">选择车位所在楼层</p>
            </div>
            
            <!-- 区域（动态加载） -->
            <div id="area-field" class="hidden" role="region" aria-labelledby="area-title">
                <label id="area-title" for="area-select" class="block text-sm font-medium text-slate-300 mb-2">
                    所在区域
                </label>
                <select name="area" 
                        id="area-select"
                        class="w-full px-4 py-3 bg-slate-900/50 border border-slate-700 rounded-lg text-white focus:outline-none focus:border-primary-500 focus:ring-1 focus:ring-primary-500"
                        aria-describedby="area-hint">
                    <option value="">无</option>
                </select>
                <p id="area-hint" class="mt-1 text-xs text-slate-500">选择车位所在区域</p>
            </div>
            
            <!-- 类型 -->
            <div>
                <label for="space-type-select" class="block text-sm font-medium text-slate-300 mb-2">
                    车位类型
                </label>
                <select id="space-type-select"
                        name="space_type"
                        class="w-full px-4 py-3 bg-slate-900/50 border border-slate-700 rounded-lg text-white focus:outline-none focus:border-primary-500 focus:ring-1 focus:ring-primary-500"
                        aria-describedby="space-type-hint">
                    {% for value, label in space_types %}
                    <option value="{{ value }}" {% if space.space_type == value %}selected{% endif %}>{{ label }}</option>
                    {% endfor %}
                </select>
                <p id="space-type-hint" class="mt-1 text-xs text-slate-500 sr-only">选择车位类型</p>
            </div>
            
            <!-- 预约状态 -->
            <div>
                <label for="is-reserved-checkbox" class="flex items-center gap-3 cursor-pointer">
                    <input type="checkbox" 
                           id="is-reserved-checkbox"
                           name="is_reserved" 
                           {% if space.is_reserved %}checked{% endif %}
                           class="w-5 h-5 rounded border-slate-600 bg-slate-900 text-primary-600 focus:ring-primary-500 focus:ring-offset-0"
                           aria-describedby="is-reserved-hint">
                    <span class="text-slate-300">已预约</span>
                </label>
                <p id="is-reserved-hint" class="mt-1 text-xs text-slate-500 ml-8">标记为已预约的车位不会分配给临时停车</p>
            </div>
        </div>
        
        <!-- 操作按钮 -->
        <div class="flex items-center gap-4" role="group" aria-label="表单操作">
            <button type="submit" 
                    class="btn-ripple inline-flex items-center gap-2 px-6 py-3 bg-primary-600 hover:bg-primary-700 text-white rounded-lg transition-colors"
                    aria-label="保存车位信息">
                <i class="fas fa-save" aria-hidden="true"></i>
                保存
            </button>
            <a href="{% url 'parking:admin_parking_space_list' %}" 
               class="px-6 py-3 text-slate-400 hover:text-white transition-colors"
               aria-label="取消并返回车位列表">
                取消
            </a>
        </div>
    </form>
</div>


<script src="{% static 'admin/parking_space/edit/js/script.js' %}"></script>
{% endblock %}

