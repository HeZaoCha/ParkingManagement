{# 基础模板 - 所有页面的公共部分，支持主题系统 #}
{% load static %}
<!DOCTYPE html>
<html lang="zh-CN" class="light" data-theme="blue">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="停车场管理系统">
  <title>{% block title %}停车场管理系统{% endblock %}</title>
  
  {# DNS 预解析和预连接 - 优化外部资源加载 #}
  <link rel="dns-prefetch" href="https://cdn.tailwindcss.com">
  <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
  <link rel="dns-prefetch" href="https://fonts.googleapis.com">
  <link rel="dns-prefetch" href="https://fonts.gstatic.com">
  <link rel="preconnect" href="https://cdn.tailwindcss.com" crossorigin>
  <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  
  {# 预加载关键资源 #}
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" as="style">
  <link rel="preload" href="{% static 'parking/css/license_plate_input.css' %}" as="style">
  <link rel="preload" href="{% static 'parking/css/components.css' %}" as="style">
  <link rel="preload" href="{% static 'parking/js/license_plate_input.js' %}" as="script">
  <link rel="preload" href="{% static 'parking/js/form_validation.js' %}" as="script">
  
  {# 预获取非关键资源 #}
  <link rel="prefetch" href="{% static 'parking/css/image_lazy_load.css' %}" as="style">
  <link rel="prefetch" href="{% static 'parking/css/skeleton.css' %}" as="style">
  <link rel="prefetch" href="{% static 'parking/js/components.js' %}" as="script">
  <link rel="prefetch" href="{% static 'parking/js/network_optimization.js' %}" as="script">
  <link rel="prefetch" href="{% static 'parking/js/image_lazy_load.js' %}" as="script">
  <link rel="prefetch" href="{% static 'parking/js/skeleton.js' %}" as="script">
  
  {# Tailwind CSS #}
  <script src="https://cdn.tailwindcss.com"></script>
  
  {# Font Awesome #}
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" 
        rel="stylesheet" 
        integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" 
        crossorigin="anonymous">
  <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
  
  {# Google Fonts #}
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  
  {# International Telephone Input - 国际手机号输入组件 #}
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/intl-tel-input@25.13.1/build/css/intlTelInput.css">
  <script src="https://cdn.jsdelivr.net/npm/intl-tel-input@25.13.1/build/js/intlTelInput.min.js"></script>
  
  {# Tailwind 配置 #}
  <script src="{% static 'base/js/tailwind_config.js' %}"></script>
  
  {# 公共工具库（必须在其他脚本之前加载） #}
  <script src="{% static 'common/js/utils.js' %}"></script>
  
  {# 公共组件样式 #}
  <link rel="stylesheet" href="{% static 'common/css/components.css' %}">
  
  {# 主题系统 CSS 变量 #}
  <link rel="stylesheet" href="{% static 'base/css/theme_system.css' %}">
  
  {# 公共样式扩展（Tailwind 层） #}
  <style type="text/tailwindcss">
    @layer utilities {
      .text-shadow {
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .transition-all-300 {
        transition: all 300ms ease-in-out;
      }
      .icon-container {
        min-width: 3rem;
        min-height: 3rem;
        display: flex;
        align-items: center;
        justify-content: center;
      }
    }
  </style>
  
  {# 车牌号输入组件样式 #}
  <link rel="stylesheet" href="{% static 'parking/css/license_plate_input.css' %}">
  
  {% block extra_css %}{% endblock %}
</head>

<body class="{% block body_class %}min-h-screen{% endblock %}">
  {# 页面内容 #}
  {% block content %}{% endblock %}
  
  {# 浮动按钮组 #}
  <div class="fixed bottom-6 right-6 z-50 flex flex-col gap-3">
    {# 联系我们按钮 #}
    <button onclick="window.location.href='/parking/contact/'" 
            class="w-14 h-14 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 text-white shadow-lg fab-enhanced flex items-center justify-center"
            title="联系我们">
      <i class="fas fa-headset text-xl fab-icon-enhanced"></i>
    </button>
    
    {# 主题切换器 #}
    <div id="theme-switcher">
      {# 主按钮 #}
      <button id="theme-toggle-btn" 
              class="w-14 h-14 rounded-full bg-gradient-theme text-white shadow-lg fab-enhanced flex items-center justify-center"
              onclick="toggleThemePanel()"
              title="主题设置">
        <i class="fas fa-palette text-xl fab-icon-enhanced"></i>
      </button>
    
    {# 主题面板 #}
    <div id="theme-panel" 
         class="absolute bottom-16 right-0 w-72 card-theme rounded-2xl p-4 opacity-0 invisible transform translate-y-4 transition-all duration-300">
      <h3 class="text-theme-primary font-semibold mb-4 flex items-center gap-2">
        <i class="fas fa-swatchbook text-primary-500"></i>
        主题设置
      </h3>
      
      {# 亮暗切换 #}
      <div class="mb-4">
        <p class="text-theme-muted text-sm mb-2">显示模式</p>
        <div class="flex gap-2">
          <button onclick="setMode('light')" 
                  class="mode-btn flex-1 py-2 px-3 rounded-lg border border-theme text-sm transition-all flex items-center justify-center gap-2 hover:bg-theme-hover"
                  data-mode="light">
            <i class="fas fa-sun text-amber-500"></i>
            <span>亮色</span>
          </button>
          <button onclick="setMode('dark')" 
                  class="mode-btn flex-1 py-2 px-3 rounded-lg border border-theme text-sm transition-all flex items-center justify-center gap-2 hover:bg-theme-hover"
                  data-mode="dark">
            <i class="fas fa-moon text-indigo-400"></i>
            <span>暗色</span>
          </button>
          <button onclick="setMode('system')" 
                  class="mode-btn flex-1 py-2 px-3 rounded-lg border border-theme text-sm transition-all flex items-center justify-center gap-2 hover:bg-theme-hover"
                  data-mode="system">
            <i class="fas fa-desktop text-theme-secondary"></i>
            <span>跟随</span>
          </button>
        </div>
      </div>
      
      {# 主题色选择 #}
      <div>
        <p class="text-theme-muted text-sm mb-2">主题色</p>
        {# 色系选择器 #}
        <div class="flex gap-2 mb-3">
          <button onclick="selectColorTone('light')" 
                  class="color-tone-btn flex-1 px-3 py-1.5 text-xs rounded-lg border transition-all duration-200 border-theme hover:bg-theme-hover" 
                  data-tone="light" 
                  title="浅色（默认）">
            浅色
          </button>
          <button onclick="selectColorTone('standard')" 
                  class="color-tone-btn flex-1 px-3 py-1.5 text-xs rounded-lg border transition-all duration-200 border-theme hover:bg-theme-hover" 
                  data-tone="standard" 
                  title="标准色">
            标准
          </button>
          <button onclick="selectColorTone('dark')" 
                  class="color-tone-btn flex-1 px-3 py-1.5 text-xs rounded-lg border transition-all duration-200 border-theme hover:bg-theme-hover" 
                  data-tone="dark" 
                  title="深色">
            深色
          </button>
          <button onclick="selectColorTone('gradient')" 
                  class="color-tone-btn flex-1 px-3 py-1.5 text-xs rounded-lg border transition-all duration-200 border-theme hover:bg-theme-hover" 
                  data-tone="gradient" 
                  title="渐变">
            渐变
          </button>
        </div>
        {# 主题颜色网格 #}
        <div id="theme-colors-container" class="grid grid-cols-5 gap-2">
          {# 浅色系（默认） #}
          <button onclick="setTheme('blue-light')" class="theme-color-btn w-10 h-10 rounded-full bg-sky-400 hover:scale-110 transition-transform flex items-center justify-center" data-theme="blue-light" data-tone="light" title="浅蓝色"><i class="fas fa-check text-white opacity-0"></i></button>
          <button onclick="setTheme('green-light')" class="theme-color-btn w-10 h-10 rounded-full bg-emerald-400 hover:scale-110 transition-transform flex items-center justify-center" data-theme="green-light" data-tone="light" title="浅绿色"><i class="fas fa-check text-white opacity-0"></i></button>
          <button onclick="setTheme('pink-light')" class="theme-color-btn w-10 h-10 rounded-full bg-pink-400 hover:scale-110 transition-transform flex items-center justify-center" data-theme="pink-light" data-tone="light" title="浅粉色"><i class="fas fa-check text-white opacity-0"></i></button>
          <button onclick="setTheme('purple-light')" class="theme-color-btn w-10 h-10 rounded-full bg-purple-400 hover:scale-110 transition-transform flex items-center justify-center" data-theme="purple-light" data-tone="light" title="浅紫色"><i class="fas fa-check text-white opacity-0"></i></button>
          <button onclick="setTheme('orange-light')" class="theme-color-btn w-10 h-10 rounded-full bg-orange-400 hover:scale-110 transition-transform flex items-center justify-center" data-theme="orange-light" data-tone="light" title="浅橙色"><i class="fas fa-check text-white opacity-0"></i></button>
          {# 标准色系 #}
          <button onclick="setTheme('blue')" class="theme-color-btn w-10 h-10 rounded-full bg-blue-500 hover:scale-110 transition-transform flex items-center justify-center hidden" data-theme="blue" data-tone="standard" title="蓝色"><i class="fas fa-check text-white opacity-0"></i></button>
          <button onclick="setTheme('purple')" class="theme-color-btn w-10 h-10 rounded-full bg-purple-500 hover:scale-110 transition-transform flex items-center justify-center hidden" data-theme="purple" data-tone="standard" title="紫色"><i class="fas fa-check text-white opacity-0"></i></button>
          <button onclick="setTheme('green')" class="theme-color-btn w-10 h-10 rounded-full bg-green-500 hover:scale-110 transition-transform flex items-center justify-center hidden" data-theme="green" data-tone="standard" title="绿色"><i class="fas fa-check text-white opacity-0"></i></button>
          <button onclick="setTheme('orange')" class="theme-color-btn w-10 h-10 rounded-full bg-orange-500 hover:scale-110 transition-transform flex items-center justify-center hidden" data-theme="orange" data-tone="standard" title="橙色"><i class="fas fa-check text-white opacity-0"></i></button>
          <button onclick="setTheme('rose')" class="theme-color-btn w-10 h-10 rounded-full bg-rose-500 hover:scale-110 transition-transform flex items-center justify-center hidden" data-theme="rose" data-tone="standard" title="玫瑰"><i class="fas fa-check text-white opacity-0"></i></button>
          {# 深色系 #}
          <button onclick="setTheme('blue-dark')" class="theme-color-btn w-10 h-10 rounded-full bg-blue-700 hover:scale-110 transition-transform flex items-center justify-center hidden" data-theme="blue-dark" data-tone="dark" title="深蓝色"><i class="fas fa-check text-white opacity-0"></i></button>
          <button onclick="setTheme('green-dark')" class="theme-color-btn w-10 h-10 rounded-full bg-green-700 hover:scale-110 transition-transform flex items-center justify-center hidden" data-theme="green-dark" data-tone="dark" title="深绿色"><i class="fas fa-check text-white opacity-0"></i></button>
          <button onclick="setTheme('purple-dark')" class="theme-color-btn w-10 h-10 rounded-full bg-purple-700 hover:scale-110 transition-transform flex items-center justify-center hidden" data-theme="purple-dark" data-tone="dark" title="深紫色"><i class="fas fa-check text-white opacity-0"></i></button>
          <button onclick="setTheme('orange-dark')" class="theme-color-btn w-10 h-10 rounded-full bg-orange-700 hover:scale-110 transition-transform flex items-center justify-center hidden" data-theme="orange-dark" data-tone="dark" title="深橙色"><i class="fas fa-check text-white opacity-0"></i></button>
          <button onclick="setTheme('rose-dark')" class="theme-color-btn w-10 h-10 rounded-full bg-rose-700 hover:scale-110 transition-transform flex items-center justify-center hidden" data-theme="rose-dark" data-tone="dark" title="深玫瑰"><i class="fas fa-check text-white opacity-0"></i></button>
          {# 渐变色系（第四类） #}
          <button onclick="setTheme('blue-gradient')" class="theme-color-btn w-10 h-10 rounded-full bg-gradient-to-br from-blue-600 to-blue-400 hover:scale-110 transition-transform flex items-center justify-center hidden" data-theme="blue-gradient" data-tone="gradient" title="蓝色渐变"><i class="fas fa-check text-white opacity-0"></i></button>
          <button onclick="setTheme('green-gradient')" class="theme-color-btn w-10 h-10 rounded-full bg-gradient-to-br from-green-600 to-green-400 hover:scale-110 transition-transform flex items-center justify-center hidden" data-theme="green-gradient" data-tone="gradient" title="绿色渐变"><i class="fas fa-check text-white opacity-0"></i></button>
          <button onclick="setTheme('purple-gradient')" class="theme-color-btn w-10 h-10 rounded-full bg-gradient-to-br from-purple-600 to-purple-400 hover:scale-110 transition-transform flex items-center justify-center hidden" data-theme="purple-gradient" data-tone="gradient" title="紫色渐变"><i class="fas fa-check text-white opacity-0"></i></button>
          <button onclick="setTheme('orange-gradient')" class="theme-color-btn w-10 h-10 rounded-full bg-gradient-to-br from-orange-600 to-orange-400 hover:scale-110 transition-transform flex items-center justify-center hidden" data-theme="orange-gradient" data-tone="gradient" title="橙色渐变"><i class="fas fa-check text-white opacity-0"></i></button>
          <button onclick="setTheme('rose-gradient')" class="theme-color-btn w-10 h-10 rounded-full bg-gradient-to-br from-rose-600 to-rose-400 hover:scale-110 transition-transform flex items-center justify-center hidden" data-theme="rose-gradient" data-tone="gradient" title="玫瑰渐变"><i class="fas fa-check text-white opacity-0"></i></button>
        </div>
      </div>
    </div>
    </div>
  </div>
  
  {# 主题系统脚本 #}
  <script src="{% static 'base/js/theme_manager.js' %}"></script>
  {# 车牌号输入组件脚本 #}
  <script src="{% static 'parking/js/license_plate_input.js' %}"></script>
  {# 表单验证工具 #}
  <script src="{% static 'parking/js/form_validation.js' %}"></script>
  {# 网络资源优化工具 #}
  <script src="{% static 'parking/js/network_optimization.js' %}"></script>
  {# 统一组件库 #}
  <link rel="stylesheet" href="{% static 'parking/css/components.css' %}">
  <script src="{% static 'parking/js/components.js' %}"></script>
  {# 图片懒加载 #}
  <link rel="stylesheet" href="{% static 'parking/css/image_lazy_load.css' %}">
  <script src="{% static 'parking/js/image_lazy_load.js' %}"></script>
  {# 骨架屏 #}
  <link rel="stylesheet" href="{% static 'parking/css/skeleton.css' %}">
  <script src="{% static 'parking/js/skeleton.js' %}"></script>
  {# 键盘导航 #}
  <script src="{% static 'parking/js/keyboard_navigation.js' %}"></script>
  {# 面包屑导航 #}
  <script src="{% static 'parking/js/breadcrumb.js' %}"></script>
  {# 表单自动保存 #}
  <script src="{% static 'parking/js/form_autosave.js' %}"></script>
  {# 全局搜索 #}
  <script src="{% static 'parking/js/search.js' %}"></script>
  {# 语言切换器 #}
  <script src="{% static 'parking/js/language_switcher.js' %}"></script>
  {# 移动端优化 #}
  <link rel="stylesheet" href="{% static 'parking/css/mobile.css' %}">
  <script src="{% static 'parking/js/mobile.js' %}"></script>
  {# 动画效果 #}
  <link rel="stylesheet" href="{% static 'parking/css/animations.css' %}">
  {# UI组件样式 #}
  <link rel="stylesheet" href="{% static 'parking/css/ui_components.css' %}">
  {# 图片优化样式 #}
  <link rel="stylesheet" href="{% static 'parking/css/image_optimization.css' %}">
  {# UI组件脚本 #}
  <script src="{% static 'parking/js/ui_components.js' %}"></script>
  {# 虚拟滚动 #}
  <script src="{% static 'parking/js/virtual_scroll.js' %}"></script>
  {# 图片优化 #}
  <script src="{% static 'parking/js/image_optimization.js' %}"></script>
  {# Service Worker #}
  <script src="{% static 'parking/js/service_worker.js' %}"></script>
  {# 缓存预热 #}
  <script src="{% static 'parking/js/cache_warmup.js' %}"></script>
  {# 智能填充 #}
  <script src="{% static 'parking/js/smart_fill.js' %}"></script>
  {# 无障碍功能 #}
  <link rel="stylesheet" href="{% static 'parking/css/accessibility.css' %}">
  <script src="{% static 'parking/js/accessibility.js' %}"></script>
  {# 资源合并 #}
  <script src="{% static 'parking/js/resource_bundler.js' %}"></script>
  {# Web Workers #}
  <script src="{% static 'parking/js/web_workers.js' %}"></script>
  {# 预渲染 #}
  <script src="{% static 'parking/js/prerender.js' %}"></script>
  {# 图标系统 #}
  <link rel="stylesheet" href="{% static 'parking/css/icon_system.css' %}">
  <script src="{% static 'parking/js/icon_system.js' %}"></script>
  {# 布局系统 #}
  <link rel="stylesheet" href="{% static 'parking/css/layout_system.css' %}">
  <script src="{% static 'parking/js/layout_system.js' %}"></script>
  {# 错误恢复 #}
  <script src="{% static 'parking/js/error_recovery.js' %}"></script>
  {# 语言包管理 #}
  <script src="{% static 'parking/js/language_manager.js' %}"></script>
  
  {# 国际手机号输入组件样式定制（与主题系统兼容） #}
  <link rel="stylesheet" href="{% static 'base/css/intl_tel_input.css' %}">
  
  {# 公共脚本 #}
  {% block extra_js %}{% endblock %}
</body>
</html>
